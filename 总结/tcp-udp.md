#   任TCP虐我千百遍，我仍待TCP如初恋

#   TCP基本认识
##  TCP头部格式
### TCP头部格式如下
![TCP头部格式](TCP头部.png)
源端口号(16bit) + 目标端口号(16bit) + 序列号(32bit) + ack序列号(32bit) + 首部长度(4bit) + 保留(6bit) + 标志位(6bit) + 窗口大小(16bit) + 校验和(16bit) + 紧急指针(16bit) + 选项(长度可变)

### 为什么需要TCP？ TCP工作在那一层?
先来说说OSI七层和tcp/IP 分层模型
OSI七层:物理层、链路层、网络层、传输层、回话层、表示层、应用层。
tcp/IP：网络接口层、网络层、传输层、应用层。

IP层是不可靠的，它不保证网络包的顺序、完整的交付。
如果需要保证网络数据包的可靠性，那么就需要有上层（传输层）的TCP协议来负责。因为TCP是一个工作在传输层的可靠的数据传输服务，它能确保接收端接收的网络包是无损坏的、无间隔的、非冗余和按序的。

### 什么是TCP？
tcp是<font color="blue">面向连接的、字节流、可靠的</font>网络传输通讯协议。
面向连接：一对一的连接，不能像UDP协议可以一个主机同时向多个主机发送消息，也就是一对多无法做到的。
可靠的：无论网络链路发生了什么样的变化，TCP都能够保证一个报文一定能够达到接收端。
字节流：用户消息通过TCP协议传输时，消息数据可能会被操作系统分组层多个TCP报文，如果接收方的程序不知道消息的边界，是无法读出一个有效数据的。并且tcp报文是有序的，当前一个tcp报文没有收到的时候，即使它收到了后面的tcp报文，那么也不会扔给应用层去处理，同时对重复的报文会自动丢弃。

### UDP和TCP有什么区别？分别应用场景是啥？
UDP不提供复杂的控制机制，利用IP提供面向无连接的通讯服务。
UDP协议真的非常简单，头部只有8个字节，UDP头部格式如下：
源端口号(16bit)+目的端口号(16bit) + 包长度(16bit) + 校验和(16bit)

TCP和UDP区别：
1、 连接：
-   TCP是面向连接的传输层协议，传输前需要建立连接
-   UDP是不需要连接，即刻传输数据。

2、 服务对象：
-   TCP是一对一的两点服务，即一条连接只有两个端点。
-   UDP支持一对一、一对多、多对多的交互通信。

3、 可靠性：
-   TCP是可靠交付数据的，数据可以无差错、不丢失、无重复、按序到达。
-   UDP是尽最大努力交付，不保证可靠的数据交付。

4、 拥塞控制、流量控制：
-   TCP有拥塞控制和流量控制机制，保证数据传输的安全性。
-   UDP则没有，即使网络拥堵了，也不会影响UDP的发送速率。

5、 首部开销：
-   TCP首部长度较长，会有一定的开销，首部再没有使用选项字段时是20字节，如果使用了会边长。
-   UDP首部只有8个字节，并且是固定不变的，开销较小。

6、 传输方式：
-   TCP是流数据，没有边界，但保证有序性和可靠。
-   UDP是一个包一个包的发送，是有边界的，但可能会丢包或乱序。